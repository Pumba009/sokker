3ï¸âƒ£ W content script â€“ poczekaÄ‡ na DOM strony

(najczystsze rozwiÄ…zanie)
```
manifest.json
{
  "content_scripts": [{
    "matches": ["https://example.com/*"],
    "js": ["content.js"],
    "run_at": "document_idle"
  }]
}
```
content.js
```
console.log('DOM strony gotowy');
```
ğŸ“Œ document_idle = DOM gotowy + wiÄ™kszoÅ›Ä‡ zasobÃ³w wczytana
ğŸ“Œ Najlepsze miejsce do manipulacji stronÄ…


"run_at": "document_idle" to moment wstrzykniÄ™cia content scriptu w rozszerzeniu Chrome.
WyjaÅ›niÄ™ dokÅ‚adnie, co to znaczy, kiedy siÄ™ uruchamia i czym rÃ³Å¼ni siÄ™ od innych opcji.


ğŸ“Œ Co to w ogÃ³le jest run_at?

run_at okreÅ›la KIEDY Chrome uruchomi content script wzglÄ™dem cyklu Å‚adowania strony.

```
"content_scripts": [{
  "matches": ["https://example.com/*"],
  "js": ["content.js"],
  "run_at": "document_idle"
}]
```

ğŸ•’ Co znaczy dokÅ‚adnie document_idle?

âœ… W praktyce:

- Uruchom content script, gdy:
- DOM jest juÅ¼ gotowy
- parser HTML skoÅ„czyÅ‚
- wiÄ™kszoÅ›Ä‡ zasobÃ³w (CSS, JS) zostaÅ‚a zaÅ‚adowana
- przeglÄ…darka jest â€bezczynnaâ€

ğŸ“Œ To jest najpÃ³Åºniejszy i najbezpieczniejszy moment.


ğŸ§  Jak Chrome decyduje?

Chrome:

1. czeka na DOMContentLoaded
2. czeka aÅ¼ JS strony przestanie intensywnie pracowaÄ‡
3. wstrzykuje content script

Nie ma dokÅ‚adnego timestampu â€” to heurystyka.

ğŸ§ª PorÃ³wnanie wszystkich run_at

| run_at              | Kiedy        | Co jest dostÄ™pne |
| ------------------- | ------------ | ---------------- |
| `document_start`    | przed HTML   | âŒ brak DOM       |
| `document_end`      | po HTML      | âœ” DOM, âŒ zasoby  |
| **`document_idle`** | po wszystkim | âœ” DOM + JS       |


ğŸ“Œ Kiedy uÅ¼ywaÄ‡ document_idle?
âœ” manipulujesz DOM
âœ” pracujesz ze SPA
âœ” nie chcesz race condition
âœ” chcesz mieÄ‡ pewnoÅ›Ä‡, Å¼e elementy juÅ¼ sÄ…

ğŸ‘‰ domyÅ›lna i polecana opcja

â— Dlaczego document_idle jest waÅ¼ne dla SPA?

SPA:

- DOM Å‚aduje siÄ™
- potem JS dynamicznie go zmienia

document_idle:

- daje Ci punkt startowy
- potem uÅ¼ywasz MutationObserver

    DOMContentLoaded = â€HTML gotowyâ€
    document_idle = â€aplikacja w miarÄ™ wystartowaÅ‚aâ€


ğŸ§© Co document_idle NIE gwarantuje

âŒ Å¼e konkretny element juÅ¼ istnieje
âŒ Å¼e aplikacja SPA skoÅ„czyÅ‚a renderowaÄ‡
```
run_at: "document_idle"
+ waitForElement(...)
```


ğŸ§  Jedno zdanie do notatek

document_idle oznacza, Å¼e Chrome uruchamia content script po zakoÅ„czeniu Å‚adowania DOM i wiÄ™kszoÅ›ci zasobÃ³w, gdy strona jest w stanie bezczynnoÅ›ci.